mixin ng-rect(x, y, width, height)
  rect(
    class=attributes.class||''
    style=attributes.style||''
    ng-click=attributes.click||''
    ng-attr-x='{{'+x+'}}' ng-attr-y='{{'+y+'}}'
    ng-attr-width='{{'+width+'}}' ng-attr-height='{{'+height+'}}')

mixin ng-line(x1, y1, x2, y2)
  line(
    class=attributes.class||''
    style=attributes.style||''
    ng-if=attributes.if||'true'
    ng-attr-x1='{{'+x1+'}}' ng-attr-y1='{{'+y1+'}}'
    ng-attr-x2='{{'+x2+'}}' ng-attr-y2='{{'+y2+'}}')

mixin ng-text(x, y)
  text(
    class=attributes.class||''
    style=attributes.style||''
    ng-attr-x='{{'+x+'}}' ng-attr-y='{{'+y+'}}')
    block

mixin ruler(placement, width, height, text)
  case placement
    when 'left'
      - var transform = ''

  +ng-line(0, 0, 0, height)
  +ng-line(width, 0, width, height)
  +ng-line(0, height+'-6', width, height+'-6')
  +ng-text(width+'/2', height+'-8')(style='text-anchor: middle;')
    =text

mixin defs
  marker(id='ArrowMend' overflow='visible' orient="auto")
    path(
      id='ArrowPath'
      d='M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 Z'
      transform='scale(0.4) rotate(180) translate(10, 0)')
  pattern(id='StairsPattern' width=100 ng-attr-height='{{scaled.aisle_height / 6}}' patternUnits='userSpaceOnUse')
    line(x1=0 y1=0 x2=100 y2=0 stroke='sliver')
  pattern(id='RailingPattern' width=100 ng-attr-height='{{(scaled.aisle_height + 1) / 4}}' patternUnits='userSpaceOnUse')
    line(x1=0 y1=0 x2=100 y2=0 stroke-width=5)
  pattern(id='RoofPattern' ng-attr-width='{{metadata.scale * 310}}' height=100 patternUnits='userSpaceOnUse')
    line(x1=0 y1=0 x2=0 y2=100 stroke-width=5)

mixin blueprint(title)
  svg.blueprint(ng-attr-width='{{defines.blueprint.width}}' ng-attr-height='{{defines.blueprint.height}}')
    g(fill='white')
      rect(x=0 y=0 ng-attr-width='{{defines.blueprint.width}}' ng-attr-height='{{defines.blueprint.height}}')
      g(transform='translate(10, 10)')
        rect(x=40 y=0 ng-attr-width='{{defines.blueprint.width - 60}}' ng-attr-height='{{defines.blueprint.height - 20}}')
        rect(x=0 y=0 width=40 height=200)
        line(x1=10 y1=0 x2=10 y2=200)
        line(x1=20 y1=0 x2=20 y2=200)
        line(x1=30 y1=0 x2=30 y2=200)
        line(x1=0 y1=50 x2=40 y2=50)
        line(x1=0 y1=100 x2=40 y2=100)
        line(x1=0 y1=150 x2=40 y2=150)
        g(transform='rotate(270 28 18)')
          text(x=0 y=-1) （日期）
          text(x=-50 y=-1) （签名）
          text(x=-100 y=-1) （实名）
          text(x=-150 y=-1) （专业）
      g(ng-attr-transform='translate({{defines.blueprint.width - 590}}, {{defines.blueprint.height - 90}})')
        rect(x=0 y=0 width=580 height=80)
        line(x1=0 y1=20 x2=580 y2=20)
        line(x1=0 y1=40 x2=580 y2=40)
        line(x1=0 y1=60 x2=580 y2=60)
        line(x1=60 y1=0 x2=60 y2=80)
        line(x1=140 y1=20 x2=140 y2=80)
        line(x1=180 y1=20 x2=180 y2=80)
        line(x1=260 y1=0 x2=260 y2=20)
        line(x1=310 y1=0 x2=310 y2=20)
        rect(x=260 y=20 width=30 height=60 fill='white')
        rect(x=290 y=20 width=160 height=60 fill='white')
        line(x1=450 y1=0 x2=450 y2=20)
        line(x1=490 y1=0 x2=490 y2=80)
        g
          text(x=0 y=14)
            tspan(x=4) 设计单位
            tspan(x=264) 工程名称
            tspan(x=454) 阶段
          text(x=0 y=34)
            tspan(x=4) 审定
            tspan(x=144) 审核
            tspan(x=454) 项目号
          text(x=0 y=54)
            tspan(x=4) 项目负责人
            tspan(x=144) 校对
            tspan(x=454) 图号
          text(x=0 y=74)
            tspan(x=4) 专业负责人
            tspan(x=144) 设计
            tspan(x=454) 日期
          text.text-vertical(x=276 y=36 letter-spacing=8) 图名
          text(x=300 y=60 style='font-size: 20')= title

    g(transform='translate(50, 10)')
      block

mixin blueprint-simple
  svg.blueprint(ng-attr-width='{{defines.blueprint.width}}' height=600)
    block
