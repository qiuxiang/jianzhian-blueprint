<svg ng-attr-width="{{defines.blueprint.width}}" height="600" class="blueprint"><marker id="ArrowMend" overflow="visible" orient="auto"><path id="ArrowPath" d="M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 Z" transform="scale(0.4) rotate(180) translate(10, 0)"></path></marker><pattern id="StairsPattern" width="100" ng-attr-height="{{scaled.aisle_height / 6}}" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="100" y2="0" stroke="sliver"></line></pattern><pattern id="RailingPattern" width="100" ng-attr-height="{{(scaled.aisle_height + 1) / 4}}" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="100" y2="0" stroke-width="5"></line></pattern><pattern id="RoofPattern" ng-attr-width="{{metadata.scale * 310}}" height="100" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="0" y2="100" stroke-width="5"></line></pattern><g transform="translate(10, 10)"><!-- 纵向标尺--><g transform="translate(0, 0)" letter-spacing="-3"><g><line x1="50" y1="0" x2="50" ng-attr-y2="{{scaled.height}}"></line><line x1="30" ng-attr-y1="{{-metadata.scale * 80}}" x2="30" ng-attr-y2="{{scaled.height + metadata.scale * 80}}"></line></g><g><line x1="22" ng-attr-y1="{{-metadata.scale * 80}}" x2="70" ng-attr-y2="{{-metadata.scale * 80}}"></line><line x1="22" ng-attr-y1="{{scaled.height + metadata.scale * 80}}" x2="70" ng-attr-y2="{{scaled.height + metadata.scale * 80}}"></line></g><g class="text-vertical"><text x="22" ng-attr-y="{{scaled.height / 2}}" text-anchor="middle">{{metadata.height * defines.K + 160}}</text><text x="74" y="0" text-anchor="middle">80</text><text x="74" ng-attr-y="{{scaled.height + 2}}" text-anchor="middle">80</text></g><g ng-repeat="i in _.range(metadata.height)" ng-attr-transform="translate(0, {{scaled.K * $index}})"><line x1="10" y1="0" x2="70" y2="0"></line><text x="44" ng-attr-y="{{scaled.K / 2}}" text-anchor="middle" class="text-vertical"><tspan>{{defines.K}}</tspan></text><g><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-3" y="3">{{$index|letter}}</text></g><g ng-attr-transform="translate(0, {{scaled.K}})" ng-if="$last"><line x1="10" y1="0" x2="70" y2="0"></line><g><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-3" y="3">{{$index + 1|letter}}</text></g></g></g><!-- 走廊标尺--><g ng-attr-transform="translate(50, {{scaled.height}})"><line x1="0" ng-attr-y1="{{metadata.scale * 80}}" x2="0" ng-attr-y2="{{scaled.aisle_width}}"></line><line x1="-10" ng-attr-y1="{{scaled.aisle_width}}" x2="20" ng-attr-y2="{{scaled.aisle_width}}"></line><text x="-6" ng-attr-y="{{scaled.aisle_width / 2}}" text-anchor="middle" class="text-vertical"><tspan>{{defines.aisle_width}}</tspan></text></g></g><g ng-attr-transform="translate({{100 + (metadata.options.stairs.left + (metadata.layer &gt; 6)) * scaled.aisle_width}}, 0)"><!-- 只有两层时的左楼梯--><g ng-if="metadata.options.stairs.left &amp;&amp; metadata.layer == 6" ng-attr-transform="translate({{-scaled.aisle_width}}, {{scaled.height - scaled.stairs_height}})"><rect fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.stairs_height}}"></rect><line x1="0" ng-attr-y1="{{scaled.stairs_height + scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width}}" ng-attr-y2="{{scaled.stairs_height + scaled.aisle_width}}" class="border"></line><line x1="0" y1="0" x2="0" ng-attr-y2="{{scaled.stairs_height + scaled.aisle_width}}" class="border"></line><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.stairs_height + scaled.aisle_width + 20}})"><line x1="0" y1="0" x2="0" y2="20"></line><line x1="0" y1="15" ng-attr-x2="{{scaled.aisle_width - metadata.scale * 80}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text></g></g><!-- 层数超过两层时的左楼梯--><g ng-if="metadata.options.stairs.left &amp;&amp; metadata.layer &gt; 6" ng-attr-transform="translate({{-scaled.aisle_width * 2}}, {{scaled.height - scaled.K}})"><!-- 层数超过两层时的右楼梯--><rect stroke-width="0" fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.K}}"></rect><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" ng-attr-y2="{{scaled.K}}"></line><line ng-attr-x1="{{scaled.aisle_width + 2.5}}" y1="0" ng-attr-x2="{{scaled.aisle_width + 2.5}}" ng-attr-y2="{{scaled.K}}"></line><rect stroke-width="0" fill="url(#StairsPattern)" ng-attr-x="{{scaled.aisle_width}}" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.K}}"></rect><!-- 楼梯下边线--><line stroke-width="0.5" x1="0" ng-attr-y1="{{scaled.K}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{scaled.K}}"></line><!-- 楼梯边缘边线--><g><line x1="0" ng-attr-y1="{{-scaled.aisle_width}}" x2="0" ng-attr-y2="{{scaled.K + scaled.aisle_width}}" class="border"></line><line x1="0" ng-attr-y1="{{-scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{-scaled.aisle_width}}" class="border"></line><line x1="0" ng-attr-y1="{{scaled.K + scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{scaled.K + scaled.aisle_width}}" class="border"></line></g><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.K + scaled.aisle_width + 20}})"><line x1="0" y1="0" x2="0" y2="20"></line><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" y2="20"></line><line x1="0" y1="15" ng-attr-x2="{{scaled.aisle_width * 2 - metadata.scale * 80}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text><text ng-attr-x="{{scaled.aisle_width + 8}}" y="10">{{defines.aisle_width}}</text></g></g><!-- 右楼梯--><g ng-if="metadata.options.stairs.right &amp;&amp; metadata.layer == 6" ng-attr-transform="translate({{scaled.width}}, {{scaled.height - scaled.stairs_height}})"><rect fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.stairs_height}}"></rect><line x1="0" ng-attr-y1="{{scaled.stairs_height + scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width}}" ng-attr-y2="{{scaled.stairs_height + scaled.aisle_width}}" class="border"></line><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" ng-attr-y2="{{scaled.stairs_height + scaled.aisle_width}}" class="border"></line><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.stairs_height + scaled.aisle_width + 20}})"><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" y2="20"></line><line ng-attr-x1="{{metadata.scale * 80}}" y1="15" ng-attr-x2="{{scaled.aisle_width}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text></g></g><!-- 层数超过两层时的右楼梯--><g ng-if="metadata.options.stairs.right &amp;&amp; metadata.layer &gt; 6" ng-attr-transform="translate({{scaled.width}}, {{scaled.height - scaled.K}})"><!-- 层数超过两层时的右楼梯--><rect stroke-width="0" fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.K}}"></rect><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" ng-attr-y2="{{scaled.K}}"></line><line ng-attr-x1="{{scaled.aisle_width + 2.5}}" y1="0" ng-attr-x2="{{scaled.aisle_width + 2.5}}" ng-attr-y2="{{scaled.K}}"></line><rect stroke-width="0" fill="url(#StairsPattern)" ng-attr-x="{{scaled.aisle_width}}" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.K}}"></rect><!-- 楼梯下边线--><line stroke-width="0.5" x1="0" ng-attr-y1="{{scaled.K}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{scaled.K}}"></line><!-- 楼梯边缘边线--><g><line ng-attr-x1="{{scaled.aisle_width * 2}}" ng-attr-y1="{{-scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{scaled.K + scaled.aisle_width}}" class="border"></line><line x1="0" ng-attr-y1="{{-scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{-scaled.aisle_width}}" class="border"></line><line x1="0" ng-attr-y1="{{scaled.K + scaled.aisle_width}}" ng-attr-x2="{{scaled.aisle_width * 2}}" ng-attr-y2="{{scaled.K + scaled.aisle_width}}" class="border"></line></g><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.K + scaled.aisle_width + 20}})"><line ng-attr-x1="{{scaled.aisle_width * 2}}" y1="0" ng-attr-x2="{{scaled.aisle_width * 2}}" y2="20"></line><line ng-attr-x1="{{scaled.aisle_width + 2}}" y1="0" ng-attr-x2="{{scaled.aisle_width + 2}}" y2="20"></line><line x1="2" y1="15" ng-attr-x2="{{scaled.aisle_width * 2 - metadata.scale * 80 + 2}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2 + 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text><text ng-attr-x="{{scaled.aisle_width + 10}}" y="10">{{defines.aisle_width}}</text></g></g><!-- 房间--><g ng-repeat="col in rooms" ng-attr-transform="translate({{scaled.K * $index}}, 0)" font-size="16" font-weight="bold" text-anchor="middle"><g ng-repeat="room in col" ng-attr-transform="translate(0, {{scaled.K * $index}})"><!-- 点击区域--><rect ng-click="clicked(room, col, $index)" x="2.5" y="2.5" ng-attr-width="{{scaled.K - 2.5}}" ng-attr-height="{{scaled.K - 2.5}}" class="hover"></rect><!-- 前--><g><g ng-if="room.front == defines.board_types.window"><rect x="0" ng-attr-y="{{scaled.K}}" ng-attr-width="{{scaled.K}}" height="2.5" class="window"></rect><text ng-attr-x="{{scaled.K / 2}}" ng-attr-y="{{scaled.K - 2}}">C</text></g><g ng-if="room.front == defines.board_types.board"><rect x="0" ng-attr-y="{{scaled.K}}" ng-attr-width="{{scaled.K}}" height="2.5" class="board"></rect></g><g ng-if="room.front == defines.board_types.gate"><rect x="0" ng-attr-y="{{scaled.K}}" ng-attr-width="{{scaled.K / 2}}" height="2.5" class="board"></rect><rect ng-attr-x="{{scaled.K - 2.5}}" ng-attr-y="{{scaled.K / 2}}" width="2.5" ng-attr-height="{{scaled.K / 2}}" class="window"></rect><text ng-attr-x="{{scaled.K * 0.75}}" ng-attr-y="{{scaled.K - 2}}">M</text><path ng-attr-d="M{{scaled.K / 2}},{{scaled.K}} Q{{scaled.K / 2}},{{scaled.K / 2}} {{scaled.K}},{{scaled.K / 2}}" stroke="silver" fill="none"></path></g></g><!-- 后--><g><rect ng-if="room.back == defines.board_types.board" x="0" y="0" ng-attr-width="{{scaled.K}}" height="2.5" class="board"></rect><g ng-if="room.back == defines.board_types.window"><rect x="0" y="0" ng-attr-width="{{scaled.K}}" height="2.5" class="window"></rect><text ng-attr-x="{{scaled.K / 2}}" y="16">C</text></g></g><!-- 左--><g><rect ng-if="room.left == defines.board_types.board" x="0" y="0" width="2.5" ng-attr-height="{{scaled.K}}" class="board"></rect></g><!-- 右--><g><rect ng-if="room.right == defines.board_types.board" ng-attr-x="{{scaled.K}}" y="0" width="2.5" ng-attr-height="{{scaled.K}}" class="board"></rect><g ng-if="room.right == defines.board_types.window"><rect ng-attr-x="{{scaled.K}}" y="0" width="2.5" ng-attr-height="{{scaled.K}}" class="window"></rect><text ng-attr-x="{{scaled.K + 10}}" ng-attr-y="{{scaled.K / 2 + 6}}">C</text></g><g ng-if="room.right == defines.board_types.gate"><rect ng-attr-x="{{scaled.K}}" ng-attr-y="{{scaled.K / 2}}" width="2.5" ng-attr-height="{{scaled.K / 2}}" class="board"></rect><rect ng-attr-x="{{scaled.K / 2}}" y="2.5" ng-attr-width="{{scaled.K / 2}}" height="2.5" class="window"></rect><text ng-attr-x="{{scaled.K}}" ng-attr-y="{{scaled.K  * 0.25 + 6}}">M</text><path ng-attr-d="M{{scaled.K / 2}},2.5 Q{{scaled.K / 2}},{{scaled.K / 2}} {{scaled.K}},{{scaled.K / 2}}" stroke="silver" fill="none"></path></g></g></g></g><!-- 走廊--><g ng-attr-transform="translate(0, {{scaled.height}})"><line x1="0" ng-attr-y1="{{scaled.aisle_width}}" ng-attr-x2="{{scaled.width}}" ng-attr-y2="{{scaled.aisle_width}}" class="border"></line><line ng-if="!metadata.options.stairs.left" x1="0" ng-attr-y1="0" x2="0" ng-attr-y2="{{scaled.aisle_width}}" class="border"></line><line ng-if="!metadata.options.stairs.right" ng-attr-x1="{{scaled.width}}" ng-attr-y1="0" ng-attr-x2="{{scaled.width}}" ng-attr-y2="{{scaled.aisle_width}}" class="border"></line></g><!-- 横向标尺--><g ng-attr-transform="translate(0, {{scaled.height + scaled.aisle_width + 20}})"><g><line x1="0" y1="15" ng-attr-x2="{{scaled.width}}" y2="15"></line><line ng-attr-x1="{{-metadata.scale * 80}}" y1="35" ng-attr-x2="{{scaled.width + metadata.scale * 80}}" y2="35"></line></g><g><line ng-attr-x1="{{-metadata.scale * 80}}" y1="0" ng-attr-x2="{{-metadata.scale * 80}}" y2="40"></line><line ng-attr-x1="{{scaled.width + metadata.scale * 80}}" y1="0" ng-attr-x2="{{scaled.width + metadata.scale * 80}}" y2="40"></line></g><text class="text-middle"><tspan ng-attr-x="{{scaled.width / 2}}" y="32">{{metadata.width * defines.K + 160}}</tspan></text><g><text x="-6" y="0">80</text><text ng-attr-x="{{scaled.width - 3}}" y="0">80</text></g><g ng-repeat="room in rooms" ng-attr-transform="translate({{scaled.K * $index}}, 0)"><line x1="0" y1="0" x2="0" y2="50"></line><line ng-if="$last" ng-attr-x1="{{scaled.K}}" y1="0" ng-attr-x2="{{scaled.K}}" y2="50"></line><text ng-attr-x="{{scaled.K / 2}}" y="10" class="text-middle">{{defines.K}}</text><g transform="translate(0, 60)"><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-3" y="3">{{$index + 1}}</text></g><g ng-attr-transform="translate({{scaled.K}}, 60)" ng-if="$last"><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-4" y="3">{{$index + 2}}</text></g></g></g></g></g></svg>