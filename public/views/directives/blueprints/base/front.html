<g ng-attr-transform="translate({{scaled.aisle_width}}, 30)"><g ng-repeat="layer in metadata.rooms" ng-attr-transform="translate(0, {{scaled.P * (metadata.layer / 3 - $index - 1) * 3}})"><g fill="transparent" ng-repeat="room in layer" ng-attr-transform="translate({{scaled.K * $index}}, 0)"><g ng-if="room[metadata.height - 1].front == defines.board_types.window"><rect style="stroke: silver; stroke-width: 3px;" x="0" ng-attr-y="{{scaled.P}}" ng-attr-width="{{scaled.K / 2}}" ng-attr-height="{{scaled.P}}"></rect><rect style="stroke: silver; stroke-width: 3px;" ng-attr-x="{{scaled.K / 2}}" ng-attr-y="{{scaled.P}}" ng-attr-width="{{scaled.K / 2}}" ng-attr-height="{{scaled.P}}"></rect><line style="stroke: silver; stroke-width: 3px;" ng-attr-x1="{{scaled.K * 0.2}}" ng-attr-y1="{{scaled.P * 1.6}}" ng-attr-x2="{{scaled.K * 0.3}}" ng-attr-y2="{{scaled.P * 1.4}}"></line><line style="stroke: silver; stroke-width: 3px;" ng-attr-x1="{{scaled.K * 0.7}}" ng-attr-y1="{{scaled.P * 1.6}}" ng-attr-x2="{{scaled.K * 0.8}}" ng-attr-y2="{{scaled.P * 1.4}}"></line><g><line style="stroke: silver;" x1="0" ng-attr-y1="{{scaled.P * 0.5}}" ng-attr-x2="{{scaled.K}}" ng-attr-y2="{{scaled.P * 2.5}}"></line><line style="stroke: silver;" x1="0" ng-attr-y1="{{scaled.P * 2.5}}" ng-attr-x2="{{scaled.K}}" ng-attr-y2="{{scaled.P * 0.5}}"></line></g></g><g ng-if="room[metadata.height - 1].front == defines.board_types.gate"><line ng-attr-x1="{{scaled.K / 2}}" y1="0" ng-attr-x2="{{scaled.K / 2}}" ng-attr-y2="{{scaled.P * 3}}"></line><line style="stroke: gray;" ng-attr-x1="{{scaled.K / 2}}" ng-attr-y1="{{metadata.scale * 800}}" ng-attr-x2="{{scaled.K}}" ng-attr-y2="{{metadata.scale * 800}}"></line><circle ng-attr-cx="{{scaled.K * 0.6}}" ng-attr-cy="{{scaled.P * 1.9}}" r="2" stroke="gray"></circle><line style="stroke: gray;" ng-attr-x1="{{scaled.K * 0.66}}" ng-attr-y1="{{scaled.P * 1.8}}" ng-attr-x2="{{scaled.K * 0.66}}" ng-attr-y2="{{scaled.P * 2.1}}"></line></g><g ng-if="room.front == defines.board_types.board"><line x1="0" ng-attr-y1="{{scaled.P * 0.5}}" ng-attr-x2="{{scaled.K}}" ng-attr-y2="{{scaled.P * 2.5}}"></line><line x1="0" ng-attr-y1="{{scaled.P * 2.5}}" ng-attr-x2="{{scaled.K}}" ng-attr-y2="{{scaled.P * 0.5}}"></line></g><rect ng-attr-width="{{scaled.K}}" ng-attr-height="{{scaled.P * 3}}"></rect></g><!-- 走廊--><g ng-if="$index != 0"><line stroke-width="3" ng-attr-x1="{{-metadata.options.stairs.left * scaled.aisle_width}}" ng-attr-y1="{{scaled.P * 3 - metadata.scale * 1200}}" ng-attr-x2="{{scaled.width + metadata.options.stairs.right * scaled.aisle_width}}" ng-attr-y2="{{scaled.P * 3 - metadata.scale * 1200}}"></line><rect fill="url(#RailingPattern)" ng-attr-x="{{-metadata.options.stairs.left * scaled.aisle_width}}" ng-attr-y="{{scaled.P * 3 - metadata.scale * 1200}}" ng-attr-width="{{scaled.width + metadata.options.stairs.left * scaled.aisle_width + metadata.options.stairs.right * scaled.aisle_width}}" ng-attr-height="{{metadata.scale * 1200}}"></rect></g></g><!-- 房顶--><g><rect fill="url(#RoofPattern)" ng-attr-x="{{-metadata.scale * 200}}" ng-attr-y="{{-metadata.scale * 600}}" ng-attr-width="{{scaled.width + metadata.scale * 400}}" ng-attr-height="{{metadata.scale * 600}}"></rect></g><!-- 屋檐--><g><rect fill="url(#RoofPattern)" ng-attr-width="{{scaled.width}}" ng-attr-height="{{metadata.scale * 200}}"></rect></g><!-- 左楼梯--><g ng-if="metadata.options.stairs.left" ng-attr-transform="translate({{-scaled.aisle_width}}, {{scaled.P * 3}})"><line stroke-width="3" x1="0" ng-attr-y1="{{-metadata.scale * 1200}}" x2="0" ng-attr-y2="{{scaled.P * 3}}"></line><rect fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.P * 3}}"></rect><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.P * 3 + 15}})"><line x1="0" y1="0" x2="0" y2="20"></line><line x1="0" y1="15" ng-attr-x2="{{scaled.aisle_width - 4}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text></g></g><!-- 右楼梯--><g ng-if="metadata.options.stairs.right" ng-attr-transform="translate({{scaled.width}}, {{scaled.P * 3}})"><rect fill="url(#StairsPattern)" x="0" y="0" ng-attr-width="{{scaled.aisle_width}}" ng-attr-height="{{scaled.P * 3}}"></rect><!-- 下标尺--><g ng-attr-transform="translate(0, {{scaled.P * 3 + 15}})"><line ng-attr-x1="{{scaled.aisle_width}}" y1="0" ng-attr-x2="{{scaled.aisle_width}}" y2="20"></line><line ng-attr-x1="{{metadata.scale * 80}}" y1="15" ng-attr-x2="{{scaled.aisle_width}}" y2="15"></line><text ng-attr-x="{{scaled.aisle_width / 2}}" y="10" text-anchor="middle">{{defines.aisle_width}}</text></g></g><!-- 标尺--><g ng-attr-transform="translate(0, {{scaled.layer + 20}})"><line x1="0" y1="10" ng-attr-x2="{{scaled.width}}" y2="10"></line><line x1="-4" y1="30" ng-attr-x2="{{scaled.width + 4}}" y2="30"></line><line x1="-4" y1="0" x2="-4" y2="35"></line><line ng-attr-x1="{{scaled.width + 4}}" y1="0" ng-attr-x2="{{scaled.width + 4}}" y2="35"></line><text text-anchor="middle" ng-attr-x="{{scaled.width / 2}}" y="28">{{defines.K * metadata.width + 160}}</text><text x="-8">80</text><text ng-attr-x="{{scaled.width - 2}}">80</text><g ng-repeat="i in _.range(metadata.width)" ng-attr-transform="translate({{scaled.K * $index}}, 0)"><line x1="0" y1="0" x2="0" y2="40"></line><line ng-if="$last" ng-attr-x1="{{scaled.K}}" y1="0" ng-attr-x2="{{scaled.K}}" y2="40"></line><text ng-attr-x="{{scaled.K / 2}}" y="8" text-anchor="middle">{{$parent.defines.K}}</text><g transform="translate(0, 50)"><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-3" y="3">{{$index + 1}}</text></g><g ng-attr-transform="translate({{$parent.scaled.K}}, 50)" ng-if="$last"><circle cx="0" cy="0" r="8" fill="transparent" stroke="black"></circle><text x="-4" y="3">{{$index + 2}}</text></g></g></g></g>